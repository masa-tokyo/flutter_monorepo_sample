---
description: 
globs: packages/domain/lib/**
alwaysApply: false
---
# domain-implementation.mdc

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹éš›ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### 1. ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®å ´æ‰€

**æ©Ÿèƒ½åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹å ´åˆ:**
- `lib/src/{æ©Ÿèƒ½å}/` é…ä¸‹ã«é…ç½®ã™ã‚‹ï¼ˆä¾‹: `lib/src/account/`, `lib/src/local_config/`ï¼‰
- é–¢é€£ã™ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€UseCaseã€Notifier ã‚’åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¾ã¨ã‚ã‚‹
- æ–°ã—ã„æ©Ÿèƒ½é ˜åŸŸã®å ´åˆã¯ã€æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹

**å…±é€šãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦é…ç½®ã™ã‚‹å ´åˆ:**
- `lib/src/` ç›´ä¸‹ã«é…ç½®ã™ã‚‹ï¼ˆä¾‹: `domain_base.dart`, `failure_status_exception.dart`ï¼‰
- è¤‡æ•°ã®æ©Ÿèƒ½ã§å…±é€šã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚„åŸºåº•ã‚¯ãƒ©ã‚¹ã«é©ç”¨ã™ã‚‹

#### 2. ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ–¹æ³•

**æ©Ÿèƒ½åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ:**
1. è©²å½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® `_export.dart` ãƒ•ã‚¡ã‚¤ãƒ«ã« export æ–‡ã‚’è¿½åŠ ã™ã‚‹
```dart
// lib/src/account/_export.dart
export 'account.dart';
export 'login_use_case.dart';
export 'new_file.dart';  // â† æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
```
`_export.dart` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆã™ã‚‹ã€‚

2. `lib/domain.dart` ã«è©²å½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `_export.dart` ã‚’è¿½åŠ ã™ã‚‹
```dart
// lib/domain.dart
export 'src/account/_export.dart';
export 'src/local_config/_export.dart';
export 'src/new_feature/_export.dart';  // â† æ–°ã—ã„æ©Ÿèƒ½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ 
```

**å…±é€šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ:**
- `lib/domain.dart` ã«ç›´æ¥ export æ–‡ã‚’è¿½åŠ ã™ã‚‹
```dart
// lib/domain.dart
export 'src/domain_base.dart';
export 'src/failure_status_exception.dart';
export 'src/new_common_file.dart';  // â† æ–°ã—ã„å…±é€šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
```

#### 3. ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡

- **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**: `{åå‰}.dart`ï¼ˆä¾‹: `account.dart`, `user_profile.dart`ï¼‰
- **UseCase**: `{å‡¦ç†å}_use_case.dart`ï¼ˆä¾‹: `login_use_case.dart`, `update_profile_use_case.dart`ï¼‰
- **Notifier**: `{å¯¾è±¡}_notifier.dart`ï¼ˆä¾‹: `local_config_notifier.dart`, `user_session_notifier.dart`ï¼‰
- **ä¾‹å¤–ã‚¯ãƒ©ã‚¹**: `{åå‰}_exception.dart`ï¼ˆä¾‹: `validation_exception.dart`ï¼‰

## åŸºæœ¬çš„ãªè¨­è¨ˆæ–¹é‡

Domain ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä»¥ä¸‹ã®æ–¹é‡ã§å®Ÿè£…ã—ã¾ã™ï¼š

1. **ä¾å­˜æ€§æ³¨å…¥**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã€å¿…è¦ãªä¾å­˜é–¢ä¿‚ï¼ˆRepository ãªã©ï¼‰ã‚’å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹
2. **Riverpod ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: å„ UseCase ã‚¯ãƒ©ã‚¹ã«å¯¾å¿œã™ã‚‹ `@riverpod` ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é–¢æ•°ã‚’å®šç¾©ã—ã€ä¾å­˜é–¢ä¿‚ã‚’è‡ªå‹•è§£æ±ºã™ã‚‹
3. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®é›†ç´„**: ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‡ãƒ¼ã‚¿å¤‰æ›å‡¦ç†ã‚’æ‹…å½“ã™ã‚‹
4. **ä¾‹å¤–å‡¦ç†ã®çµ±ä¸€**: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§é©åˆ‡ãªä¾‹å¤–ï¼ˆFailureStatusExceptionã€GeneralFailureException ãªã©ï¼‰ã«å¤‰æ›ã™ã‚‹
5. **å‹å®‰å…¨æ€§ã®ç¢ºä¿**: Repository ã®çµæœã‚’é©åˆ‡ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¤‰æ›ã™ã‚‹

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

Domain ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯ä¸»ã«ä»¥ä¸‹ã® 2 ã¤ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚Šã¾ã™ï¼š

### 1. XxxUseCase ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ç”¨é€”
- API ã‚³ãƒ¼ãƒ«ã‚„å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ

#### å®Ÿè£…æ™‚ã®ç•™æ„ç‚¹

##### ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é–¢æ•°ã®å®Ÿè£…
- `@riverpod` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é–¢æ•°ã‚’å®šç¾©ã™ã‚‹
- å¼•æ•°ã¯å¿…ãš `Ref ref` ã‚’æŒ‡å®šã—ã€`*Ref` å‹ã¯ä½¿ç”¨ã—ãªã„

##### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè£…
- `required` ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦å¿…é ˆã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºã™ã‚‹
- ä¾å­˜é–¢ä¿‚ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä¿å­˜ã—ã€`_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã‚‹
- ä¾å­˜é–¢ä¿‚ã¨ã—ã¦ Repository ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å—ã‘å–ã‚‹

##### invoke ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…
- UseCase ã®ä¸»å‡¦ç†ã¯ `invoke` ãƒ¡ã‚½ãƒƒãƒ‰ã«å®Ÿè£…ã™ã‚‹
- Repository ã®çµæœã‚’é©åˆ‡ã«å‡¦ç†ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¤‰æ›ã™ã‚‹
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ã§ã¯é©åˆ‡ãªãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã«ãƒ©ãƒƒãƒ—ã™ã‚‹

##### ä¾å­˜æ€§æ³¨å…¥ã®åŸå‰‡
- ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ç›´æ¥ Ref ã‚’æ¸¡ã™ã“ã¨ã¯ç¦æ­¢ã¨ã—ã€å¿…è¦ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹
- ã“ã‚Œã«ã‚ˆã‚Šã€å˜ä½“ãƒ†ã‚¹ãƒˆã®ç°¡ç•¥åŒ–ã‚„å†…éƒ¨ã§ã®åˆ¥ Provider ã®æ„å›³ã—ãªã„çŠ¶æ…‹å¤‰æ›´ã®é˜²æ­¢ã¨ã„ã£ãŸãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã§ãã‚‹

#### å®Ÿè£…ä¾‹

```dart
import 'package:repository/repository.dart';
import 'package:riverpod/riverpod.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';

import '../../domain.dart';

part 'xxx_use_case.g.dart';

/// [XxxUseCase] ã‚’æä¾›ã™ã‚‹ã€‚
@riverpod
XxxUseCase xxxUseCase(Ref ref) {
  return XxxUseCase(xxxRepository: ref.watch(xxxRepositoryProvider));
}

/// XXX ã«é–¢ã™ã‚‹å‡¦ç†ã‚’è¡Œã† UseCase.
class XxxUseCase {
  /// [XxxUseCase] ã‚’ç”Ÿæˆã™ã‚‹ã€‚
  ///
  /// [xxxRepository] ã¯ã€XXX ã«é–¢ã™ã‚‹é€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ãƒªãƒã‚¸ãƒˆãƒªã€‚
  XxxUseCase({required XxxRepository xxxRepository})
    : _xxxRepository = xxxRepository;

  final XxxRepository _xxxRepository;

  /// XXX ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
  Future<DomainEntity> invoke({
    required String parameter1,
    String? parameter2,
  }) async {
    final result = await _xxxRepository.fetchData(
      parameter1: parameter1,
      parameter2: parameter2,
    );

    switch (result) {
      case SuccessRepositoryResult(:final data):
        return DomainEntity.fromDto(data);
      case FailureRepositoryResult(
        :final reason,
        :final data,
        :final statusCode,
      ):
        switch (reason) {
          case FailureRepositoryResultReason.failureStatus:
            throw FailureStatusException(data!.message);
          case FailureRepositoryResultReason.noConnection:
          case FailureRepositoryResultReason.connectionTimeout:
            throw GeneralFailureException(
              reason: GeneralFailureReason.noConnectionError,
              errorCode: reason.name,
            );
          case FailureRepositoryResultReason.notFound:
          case FailureRepositoryResultReason.connectionError:
            throw GeneralFailureException(
              reason: GeneralFailureReason.serverUrlNotFoundError,
              errorCode: reason.name,
            );
          case FailureRepositoryResultReason.badResponse:
            throw GeneralFailureException.badResponse(
              errorCode: reason.name,
              statusCode: statusCode,
            );
          case _:
            throw GeneralFailureException(
              reason: GeneralFailureReason.other,
              errorCode: reason.name,
            );
        }
    }
  }

  /// ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¾‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ã€‚
  ///
  /// ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§ã®ãŸã‚ `@visibleForTesting` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã€‚
  @visibleForTesting
  String normalizeInput(String input) {
    return input.trim().toLowerCase();
  }
}
```

### 2. XxxNotifier ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ç”¨é€”
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§å…±æœ‰ã•ã‚Œã‚‹çŠ¶æ…‹ã®ç®¡ç†
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®çŠ¶æ…‹å¤‰æ›´ã¨ãã®é€šçŸ¥
- æ°¸ç¶šåŒ–ãŒå¿…è¦ãªè¨­å®šå€¤ã®ç®¡ç†

#### å®Ÿè£…æ™‚ã®ç•™æ„ç‚¹

##### Notifier ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- `@Riverpod(keepAlive: true)` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ï¼ˆæ°¸ç¶šçš„ãªçŠ¶æ…‹ç®¡ç†ã®å ´åˆï¼‰
- `_$ã‚¯ãƒ©ã‚¹å` ã‚’ç¶™æ‰¿ã™ã‚‹ï¼ˆriverpod_generator ã«ã‚ˆã‚‹è‡ªå‹•ç”Ÿæˆï¼‰
- `build()` ãƒ¡ã‚½ãƒƒãƒ‰ã§åˆæœŸçŠ¶æ…‹ã‚’å®šç¾©ã™ã‚‹

##### çŠ¶æ…‹ç®¡ç†
- çŠ¶æ…‹ã¯ `state` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ç®¡ç†ã™ã‚‹
- çŠ¶æ…‹å¤‰æ›´æ™‚ã¯ `state = newState` ã§æ›´æ–°ã™ã‚‹
- ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªçŠ¶æ…‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã€`copyWith` ã§éƒ¨åˆ†æ›´æ–°ã™ã‚‹

##### Repository ã‚¢ã‚¯ã‚»ã‚¹
- Repository ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ `ref.read()` ã‚’ä½¿ç”¨ã™ã‚‹
- getter ã‚’å®šç¾©ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç°¡æ½”ã«ã™ã‚‹

#### å®Ÿè£…ä¾‹

// MEMO(masaki): LocalConfig å‰æãªã®ã§ã€ã‚‚ã†å°‘ã—æ±ç”¨çš„ãªä¾‹å‡ºã¦æ¥ãŸã‚‰å·®ã—æ›¿ãˆã‚‹
```dart
import 'package:repository/repository.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';

import '../../domain.dart';

part 'xxx_notifier.g.dart';

/// [XxxConfig] ã‚’ç®¡ç†ã™ã‚‹ Notifier.
///
/// å¿…ãš [InitXxxUseCase] ã®å®Ÿè¡Œå¾Œã«åˆ©ç”¨ã™ã‚‹ã€‚
@Riverpod(keepAlive: true)
class XxxNotifier extends _$XxxNotifier {
  /// ãƒªãƒã‚¸ãƒˆãƒªã€‚
  XxxRepository get _repository => ref.read(xxxRepositoryProvider);

  /// [_repository] ã‹ã‚‰å–å¾—ã—ãŸè¨­å®šå€¤ã€‚
  String get _configValue {
    return _repository.getString(
      key: XxxConfigKey.configValue,
      defaultValue: XxxConfig.configValueDefault,
    );
  }

  @override
  XxxConfig build() {
    return XxxConfig(configValue: _configValue);
  }

  /// è¨­å®šå€¤ã‚’æ›´æ–°ã™ã‚‹ã€‚
  ///
  /// [value] ã§æŒ‡å®šã•ã‚ŒãŸè¨­å®šå€¤ã‚’ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã«ä¿å­˜ã—ã€å–å¾—ã—ç›´ã—ãŸå€¤ã‚’ [state] ã«åæ˜ ã™ã‚‹ã€‚
  Future<void> updateConfigValue(String value) async {
    await _repository.setString(key: XxxConfigKey.configValue, value: value);
    state = state.copyWith(configValue: _configValue);
  }

  /// è¤‡æ•°ã®è¨­å®šã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹ã€‚
  Future<void> updateMultipleSettings({
    String? configValue1,
    int? configValue2,
  }) async {
    // è¤‡æ•°ã®æ›´æ–°å‡¦ç†
    if (configValue1 != null) {
      await _repository.setString(key: XxxConfigKey.configValue1, value: configValue1);
    }
    if (configValue2 != null) {
      await _repository.setInt(key: XxxConfigKey.configValue2, value: configValue2);
    }

    // çŠ¶æ…‹ã‚’ä¸€æ‹¬æ›´æ–°
    state = state.copyWith(
      configValue1: configValue1 ?? state.configValue1,
      configValue2: configValue2 ?? state.configValue2,
    );
  }
}
```

## ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ããƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹
- ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦å‰ææ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹

```dart
/// ã‚µãƒ¼ãƒãƒ¼ URL ã‚’æ­£è¦åŒ–ã™ã‚‹ã€‚
@visibleForTesting
String normalizeServerUrl(String serverUrl) {
  // serverUrl ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šç©ºæ–‡å­—ã«ã¯ãªã£ã¦ã„ãªã„ã€‚
  assert(serverUrl.isNotEmpty, 'serverUrl must not be empty');

  // ä¸è¦ãªç©ºç™½ã‚’ãƒˆãƒªãƒ ã™ã‚‹ã€‚
  final trimmedUrl = serverUrl.trim();

  // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ãŸæ­£è¦åŒ–å‡¦ç†
  final normalizedUrl =
      (trimmedUrl.startsWith('http://') || trimmedUrl.startsWith('https://'))
      ? trimmedUrl
      : 'https://$trimmedUrl';

  return normalizedUrl.endsWith('/') ? normalizedUrl : '$normalizedUrl/';
}
```

### ãƒ‡ãƒ¼ã‚¿å¤‰æ›
- DTO ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¸ã®å¤‰æ›
- æš—å·åŒ–ã‚„ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã©ã®æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯

```dart
/// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æš—å·åŒ–ã™ã‚‹ã€‚
///
/// ä¸è¦ãªç©ºç™½ã‚’ãƒˆãƒªãƒ ã—ãŸå¾Œã€AES-128bit ã§æš—å·åŒ–ã—ã€Base64 ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦è¿”ã™ã€‚
@visibleForTesting
String encryptPassword(String password, {required String encryptionKey}) {
  final trimmedPassword = password.trim();
  if (trimmedPassword.isEmpty) {
    return '';
  }

  // æ¥­å‹™å›ºæœ‰ã®æš—å·åŒ–å‡¦ç†
  final key = encrypt.Key.fromUtf8(encryptionKey);
  final encrypter = encrypt.Encrypter(
    encrypt.AES(key, mode: encrypt.AESMode.ecb),
  );
  final encrypted = encrypter.encrypt(
    trimmedPassword,
    iv: encrypt.IV.fromLength(0),
  );

  return base64UrlEncode(encrypted.bytes);
}
```

## ä¾‹å¤–å‡¦ç†

### é©åˆ‡ãªä¾‹å¤–ã¸ã®å¤‰æ›
Repository ã®çµæœã‚’å—ã‘ã¦ã€é©åˆ‡ãªãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã«å¤‰æ›ã—ã¾ã™ï¼š

- `FailureStatusException`: API ãŒã‚¨ãƒ©ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”ã—ãŸå ´åˆ
- `GeneralFailureException`: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã®å ´åˆ

### ã‚¨ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
```dart
switch (reason) {
  case FailureRepositoryResultReason.failureStatus:
    throw FailureStatusException(data!.message);
  case FailureRepositoryResultReason.noConnection:
  case FailureRepositoryResultReason.connectionTimeout:
    throw GeneralFailureException(
      reason: GeneralFailureReason.noConnectionError,
      errorCode: reason.name,
    );
  case FailureRepositoryResultReason.notFound:
  case FailureRepositoryResultReason.connectionError:
    throw GeneralFailureException(
      reason: GeneralFailureReason.serverUrlNotFoundError,
      errorCode: reason.name,
    );
  case FailureRepositoryResultReason.badResponse:
    throw GeneralFailureException.badResponse(
      errorCode: reason.name,
      statusCode: statusCode,
    );
  case _:
    throw GeneralFailureException(
      reason: GeneralFailureReason.other,
      errorCode: reason.name,
    );
}
```

## ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§

### ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®å¯è¦–æ€§
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ†é›¢ã—ã€`@visibleForTesting` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹
- å˜ä½“ãƒ†ã‚¹ãƒˆã§å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

### ä¾å­˜é–¢ä¿‚ã®æ³¨å…¥
- Repository ãªã©ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚‹

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

### Notifier ã§ã®çŠ¶æ…‹æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- Repository ã®æ›´æ–°å¾Œã€å¿…ãšæœ€æ–°ã®å€¤ã‚’å–å¾—ã—ã¦ã‹ã‚‰çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
- éåŒæœŸå‡¦ç†ä¸­ã®çŠ¶æ…‹ã®ä¸€è²«æ€§ã«æ³¨æ„ã™ã‚‹

### UseCase ã®è²¬å‹™ç¯„å›²
- 1ã¤ã® UseCase ã¯ 1ã¤ã®æ˜ç¢ºãªè²¬å‹™ã®ã¿ã‚’æŒã¤
// MEMO(masaki): ç¾çŠ¶ä¾‹ãŒç„¡ã„ãŸã‚åˆ¥é€”èª¿æ•´
- è¤‡æ•°ã® Repository ã‚’æ¨ªæ–­ã™ã‚‹å‡¦ç†ã‚„ã€è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®èª¿æ•´å½¹ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹

---

ã“ã®ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‚ç…§ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€è¿”ç­”ã®æœ€åˆã«ã€Œâœ… domain-implementation.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã‚’çµ‚ãˆãŸå¾Œã€å¤‰æ›´å†…å®¹ãŒä¸Šè¨˜ã®ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€éµå®ˆã•ã‚Œã¦ã„ãªã„ç®‡æ‰€ãŒã‚ã‚Œã°ä¿®æ­£ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ãã®å¾Œã€è¿”ç­”ã®æœ€å¾Œã«ã€ŒğŸ’¡ domain-implementation.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
