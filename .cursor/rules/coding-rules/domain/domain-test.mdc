---
description: 
globs: packages/domain/test/**
alwaysApply: false
---
# domain-test.mdc


## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

domain ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`lib/src` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ `test/src` ã«åæ˜ ã—ã¦é…ç½®ã—ã¾ã™ã€‚

- ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `lib/src/{æ©Ÿèƒ½å}/xxx.dart` ã«ã‚ã‚‹å ´åˆã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ `test/src/{æ©Ÿèƒ½å}/xxx_test.dart` ã«é…ç½®ã™ã‚‹
- å…±é€šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã¯ `test/src/` ç›´ä¸‹ã«é…ç½®ã™ã‚‹


## åŸºæœ¬çš„ãªè¨­è¨ˆæ–¹é‡

Domain ãƒ†ã‚¹ãƒˆã¯ä»¥ä¸‹ã®æ–¹é‡ã§å®Ÿè£…ã—ã¾ã™ï¼š

1. **ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ**: ä¾å­˜æ€§æ³¨å…¥ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
2. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**: UseCase ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ Notifier ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæœŸå¾…é€šã‚Šã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ**: å„å¤±æ•—ã‚±ãƒ¼ã‚¹ã§é©åˆ‡ãªä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆ**: å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›ãƒ»æ­£è¦åŒ–å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
5. **çŠ¶æ…‹ç®¡ç†ãƒ†ã‚¹ãƒˆ**: Notifier ã®å ´åˆã€çŠ¶æ…‹ã®å¤‰æ›´ãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã«ã¤ã„ã¦

ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒå¸¸ã« 100% ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã—ã€ä»¥ä¸‹ã®å ´åˆã«ãŠã„ã¦ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒã‚«ãƒãƒ¬ãƒƒã‚¸ã«å«ã¾ã‚Œãªã„ã“ã¨ãŒã‚ã‚‹ãŸã‚æ³¨æ„ã—ã¦ãã ã•ã„ï¼š

1. å˜ä¸€ã® return æ–‡ã®ã¿ã‚’å«ã‚€ if æ–‡å†…ï¼ˆå‚è€ƒï¼š https:/github.com/dart-lang/tools/issues/450)
2. ä¸‰é …æ¼”ç®—å­
3. assert æ–‡ãŒ false ã®å ´åˆ

ãã®ãŸã‚ã€100% ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆã™ã‚‹ãŸã‚ã ã‘ã§ãªãã€ä¸Šè¨˜ã®ã‚ˆã†ãªã™ã¹ã¦ã®æ½œåœ¨çš„ãªã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’å¿µé ­ã«ç½®ã„ã¦ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

## å®Ÿè£…æ™‚ã®ç•™æ„ç‚¹

### ãƒ•ã‚¡ã‚¤ãƒ«å†…æ§‹æˆ

Domain ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã¯ä»¥ä¸‹ã®æ§‹æˆã§çµ„ç¹”åŒ–ã—ã¾ã™ï¼š

1. **ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ**: `{ã‚¯ãƒ©ã‚¹å}Provider ã®ãƒ†ã‚¹ãƒˆã€‚`
2. **UseCase ã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆ**: `{ã‚¯ãƒ©ã‚¹å} ã®ãƒ†ã‚¹ãƒˆã€‚`
   - å„ãƒ¡ã‚½ãƒƒãƒ‰å˜ä½ã§ `{ãƒ¡ã‚½ãƒƒãƒ‰å} ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆã€‚` ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
   - å„ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ `æˆåŠŸã‚·ãƒŠãƒªã‚ªã€‚` ã¨ `å¤±æ•—ã‚·ãƒŠãƒªã‚ªã€‚` ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‘ã¦ãƒ†ã‚¹ãƒˆ

### ãƒ¢ãƒƒã‚¯ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®é¸æŠ
- `@GenerateMocks` ã§ã¯ãªã `@GenerateNiceMocks([MockSpec<T>()])` ã‚’ä½¿ç”¨ã™ã‚‹
- `@GenerateNiceMocks` ã¯ã‚¹ã‚¿ãƒ–ã•ã‚Œã¦ã„ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™ãŸã‚ã€ã‚ˆã‚Šå …ç‰¢ãªãƒ†ã‚¹ãƒˆãŒå¯èƒ½
- `RepositoryResult` ãªã©ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã¯ãªã„è¤‡é›‘ãªå‹ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹å ´åˆã€`provideDummy()` ã«ã‚ˆã‚Šé©åˆ‡ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹ 

### ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆã®å®Ÿè£…
- `ProviderContainer` ã‚’ä½¿ç”¨ã—ã¦ä¾å­˜ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆRepository ãªã©ï¼‰ã‚’ãƒ¢ãƒƒã‚¯ã§ä¸Šæ›¸ã
- `setUp()` ã¨ `tearDown()` ã§ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆã¨ç ´æ£„ã‚’è¡Œã†


### æˆåŠŸã‚·ãƒŠãƒªã‚ªã®æ¤œè¨¼
- ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿”ã•ã‚Œã‚‹ Domain ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- Domain ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæœŸå¾…ã™ã‚‹å€¤ã«è¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
- ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ã„å¼•æ•°ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›ãƒ»æ­£è¦åŒ–å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- Notifier ã®å ´åˆã€çŠ¶æ…‹ãŒæœŸå¾…é€šã‚Šã«å¤‰æ›´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è©³ç´°æ¤œè¨¼
- `FailureRepositoryResultReason` ã«åŸºã¥ã„ã¦é©åˆ‡ãªä¾‹å¤–ï¼ˆ`FailureStatusException`ã€`GeneralFailureException`ï¼‰ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- ä¾‹å¤–ã® `reason`ã€`errorCode`ã€`statusCode` ãªã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
- ç‰¹å®šã®ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒªãƒã‚¸ãƒˆãƒªã§ç™ºç”Ÿã—ãŸä¾‹å¤–ãŒãƒªã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ
- URL æ­£è¦åŒ–ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æš—å·åŒ–ãªã©ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆç©ºæ–‡å­—ã€ç©ºç™½ã®ã¿ã€ç‰¹æ®Šæ–‡å­—ãªã©ï¼‰ã‚’å«ã‚ã¦åŒ…æ‹¬çš„ã«ãƒ†ã‚¹ãƒˆ


## å®Ÿè£…ä¾‹

### UseCase ã®ãƒ†ã‚¹ãƒˆä¾‹

```dart
import 'package:domain/domain.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';
import 'package:repository/repository.dart';
import 'package:riverpod/riverpod.dart';

import 'xxx_use_case_test.mocks.dart';

// XxxRepository ã®ãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã€‚
@GenerateNiceMocks([MockSpec<XxxRepository>()])
void main() {
  late MockXxxRepository mockXxxRepository;
  late XxxUseCase xxxUseCase;

  setUp(() {
    mockXxxRepository = MockXxxRepository();
    xxxUseCase = XxxUseCase(xxxRepository: mockXxxRepository);

    // ã‚¹ã‚¿ãƒ–ã•ã‚Œã¦ã„ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã€é©åˆ‡ãªå¤±æ•—çµæœã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚‹ã€‚
    provideDummy<RepositoryResult<XxxDto>>(
      RepositoryResult<XxxDto>.failure(
        Exception(),
        reason: FailureRepositoryResultReason.unknown,
        data: const XxxDto(isFailureStatus: true),
      ),
    );
  });

  group('xxxUseCaseProvider ã®ãƒ†ã‚¹ãƒˆã€‚', () {
    test('xxxUseCaseProvider ãŒ XxxUseCase ã‚’è¿”ã™ã€‚', () {
      final container = ProviderContainer(
        overrides: [
          // ä¾å­˜ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ãƒ¢ãƒƒã‚¯ã§ç½®ãæ›ãˆã‚‹ã€‚
          xxxRepositoryProvider.overrideWithValue(mockXxxRepository),
        ],
      );
      addTearDown(container.dispose);
      expect(container.read(xxxUseCaseProvider), isA<XxxUseCase>());
    });
  });

  group('XxxUseCase ã®ãƒ†ã‚¹ãƒˆã€‚', () {
    group('invoke ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆã€‚', () {
      /// ãƒ€ãƒŸãƒ¼ã®å€¤ã‚’ç”¨ã„ã¦å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
      Future<XxxEntity> invoke() async {
        return xxxUseCase.invoke(
          parameter1: 'testValue1',
          parameter2: 'testValue2',
        );
      }

      group('æˆåŠŸã‚·ãƒŠãƒªã‚ªã€‚', () {
        test('å‡¦ç†ã«æˆåŠŸã—ãŸå ´åˆã€Entity ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ã€‚', () async {
          // ãƒ€ãƒŸãƒ¼ã®å€¤ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹æƒ³å®šã®å¼•æ•°ã‚’å…ƒã«ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
          when(
            mockXxxRepository.methodName(
              parameter1: anyNamed('parameter1'),
              parameter2: anyNamed('parameter2'),
            ),
          ).thenAnswer(
            (_) async => const RepositoryResult<XxxDto>.success(
              XxxDto(
                isFailureStatus: false,
                field1: 'value1',
                field2: 123,
                // ... å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¨ã¦å®šç¾©
              ),
            ),
          );

          // å‡¦ç†å®Ÿè¡Œå¾Œã€è¿”ã‚Šå€¤ãŒ Entity ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
          final result = await invoke();
          expect(result, isA<XxxEntity>());

          // Entity ã®å€¤ã‚’ç¢ºèªã™ã‚‹ã€‚
          expect(result.field1, 'value1');
          expect(result.field2, 123);
          // ... å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
        });
      });

      group('å¤±æ•—ã‚·ãƒŠãƒªã‚ªã€‚', () {
        /// ã©ã®å¼•æ•°ã§å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã‚‚å¤±æ•—çµæœã‚’è¿”ã™ã€‚
        ///
        /// å„ãƒ†ã‚¹ãƒˆå†…ã§ã¯ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        void setupMockRepositoryMethod(
          FailureRepositoryResult<XxxDto> failureResult,
        ) {
          when(
            mockXxxRepository.methodName(
              parameter1: anyNamed('parameter1'),
              parameter2: anyNamed('parameter2'),
            ),
          ).thenAnswer((_) async => failureResult);
        }

        test(
          'failureStatus ã«ã‚ˆã‚Šå¤±æ•—ã—ãŸå ´åˆã€FailureStatusException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚',
          () async {
            // failureStatus ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
            setupMockRepositoryMethod(
              const FailureRepositoryResult<XxxDto>(
                {'isFailureStatus': true, 'message': 'test'},
                reason: FailureRepositoryResultReason.failureStatus,
                data: XxxDto(isFailureStatus: true, message: 'test'),
              ),
            );

            // å‡¦ç†å®Ÿè¡Œæ™‚ã€FailureStatusException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã€ãã®ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
            expect(
              invoke,
              throwsA(
                isA<FailureStatusException>().having(
                  (e) => e.message,
                  'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ Dto ã® message ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ã€‚',
                  'test',
                ),
              ),
            );
          },
        );

        test(
          'noConnection ã«ã‚ˆã‚Šå¤±æ•—ã—ãŸå ´åˆã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚',
          () async {
            // noConnection ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
            setupMockRepositoryMethod(
              FailureRepositoryResult<XxxDto>(
                Exception(),
                reason: FailureRepositoryResultReason.noConnection,
              ),
            );

            // å‡¦ç†å®Ÿè¡Œæ™‚ã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã€ãã®ä¾‹å¤–ã®å†…å®¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
            expect(
              invoke,
              throwsA(
                isA<GeneralFailureException>()
                    .having(
                      (e) => e.reason,
                      'å¤±æ•—ç†ç”±ã«ã¯ noConnectionError ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                      GeneralFailureReason.noConnectionError,
                    )
                    .having(
                      (e) => e.errorCode,
                      'ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã¯ noConnection ã®æ–‡å­—åˆ—ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                      FailureRepositoryResultReason.noConnection.name,
                    ),
              ),
            );
          },
        );

        test('notFound ã«ã‚ˆã‚Šå¤±æ•—ã—ãŸå ´åˆã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚', () async {
          // notFound ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
          setupMockRepositoryMethod(
            FailureRepositoryResult<XxxDto>(
              Exception(),
              reason: FailureRepositoryResultReason.notFound,
            ),
          );

          // å‡¦ç†å®Ÿè¡Œæ™‚ã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã€ãã®ä¾‹å¤–ã®å†…å®¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
          expect(
            invoke,
            throwsA(
              isA<GeneralFailureException>()
                  .having(
                    (e) => e.reason,
                    'å¤±æ•—ç†ç”±ã«ã¯ serverUrlNotFoundError ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                    GeneralFailureReason.serverUrlNotFoundError,
                  )
                  .having(
                    (e) => e.errorCode,
                    'ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã¯ notFound ã®æ–‡å­—åˆ—ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                    FailureRepositoryResultReason.notFound.name,
                  ),
            ),
          );
        });

        test(
          'badResponse ã«ã‚ˆã‚Šå¤±æ•—ã—ãŸå ´åˆã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚',
          () async {
            // badResponse ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
            setupMockRepositoryMethod(
              FailureRepositoryResult<XxxDto>(
                Exception(),
                reason: FailureRepositoryResultReason.badResponse,
                statusCode: 500,
              ),
            );

            // å‡¦ç†å®Ÿè¡Œæ™‚ã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã€ãã®ä¾‹å¤–ã®å†…å®¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
            expect(
              invoke,
              throwsA(
                isA<GeneralFailureException>()
                    .having(
                      (e) => e.reason,
                      'å¤±æ•—ç†ç”±ã«ã¯ badResponse ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                      GeneralFailureReason.badResponse,
                    )
                    .having(
                      (e) => e.errorCode,
                      'ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã¯ badResponse ã®æ–‡å­—åˆ—ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                      FailureRepositoryResultReason.badResponse.name,
                    )
                    .having((e) => e.statusCode, 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã‚‹ã€‚', 500),
              ),
            );
          },
        );

        test('ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šå¤±æ•—ã—ãŸå ´åˆã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚', () async {
          // cancel ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
          setupMockRepositoryMethod(
            FailureRepositoryResult<XxxDto>(
              Exception(),
              reason: FailureRepositoryResultReason.cancel,
            ),
          );

          // å‡¦ç†å®Ÿè¡Œæ™‚ã€GeneralFailureException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã€ãã®ä¾‹å¤–ã®å†…å®¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
          expect(
            invoke,
            throwsA(
              isA<GeneralFailureException>()
                  .having(
                    (e) => e.reason,
                    'å¤±æ•—ç†ç”±ã«ã¯ other ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                    GeneralFailureReason.other,
                  )
                  .having(
                    (e) => e.errorCode,
                    'ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã¯ cancel ã®æ–‡å­—åˆ—ãŒè¨­å®šã•ã‚Œã‚‹ã€‚',
                    FailureRepositoryResultReason.cancel.name,
                  ),
            ),
          );
        });
      });
    });

    group('utilityMethod ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆã€‚', () {
      test('ç©ºæ–‡å­—ã®å ´åˆã¯ assert ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã€‚', () {
        // ç©ºæ–‡å­—ã®å ´åˆã€AssertionError ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        expect(
          () => xxxUseCase.utilityMethod(''),
          throwsA(isA<AssertionError>()),
        );
      });

      test('æ­£å¸¸ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚', () {
        // æ­£å¸¸ãªå€¤ã®å ´åˆã€æœŸå¾…ã™ã‚‹çµæœãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        final result = xxxUseCase.utilityMethod('testInput');
        expect(result, 'expectedOutput');
      });

      test('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚', () {
        // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆç©ºç™½ã®ã¿ã€ç‰¹æ®Šæ–‡å­—ãªã©ï¼‰ã®å‡¦ç†ã‚’ç¢ºèªã™ã‚‹ã€‚
        final result = xxxUseCase.utilityMethod('  testInput  ');
        expect(result, 'expectedTrimmedOutput');
      });
    });
  });
}
```
// MEMO(masaki): LocalConfigNotifier å‰æã®ä¾‹ã«ãªã£ã¦ã„ã‚‹
### Notifier ã®ãƒ†ã‚¹ãƒˆä¾‹

```dart
import 'package:domain/domain.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';
import 'package:repository/repository.dart';
import 'package:riverpod/riverpod.dart';

import 'xxx_notifier_test.mocks.dart';

// XxxRepository ã®ãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã€‚
@GenerateNiceMocks([MockSpec<XxxRepository>()])
void main() {
  late MockXxxRepository mockXxxRepository;
  late ProviderContainer container;

  setUp(() {
    mockXxxRepository = MockXxxRepository();
    container = ProviderContainer(
      overrides: [
        xxxRepositoryProvider.overrideWithValue(mockXxxRepository),
      ],
    );
  });

  tearDown(() {
    container.dispose();
  });

  group('xxxNotifierProvider ã®ãƒ†ã‚¹ãƒˆã€‚', () {
    test('xxxNotifierProvider ãŒ XxxNotifier ã‚’è¿”ã™ã€‚', () {
      expect(
        container.read(xxxNotifierProvider.notifier),
        isA<XxxNotifier>(),
      );
    });
  });

  group('XxxNotifier ã®ãƒ†ã‚¹ãƒˆã€‚', () {
    group('build ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆã€‚', () {
      test('ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§ Xxx ã‚’ç”Ÿæˆã™ã‚‹ã€‚', () {
        const testValue = 'testValue';

        // getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒæŒ‡å®šã•ã‚ŒãŸå€¤ã‚’è¿”ã™ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).thenReturn(testValue);

        // state ã‚’å–å¾—ã—ã€æœŸå¾…ã™ã‚‹å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        final state = container.read(xxxNotifierProvider);

        expect(state, isA<Xxx>());
        expect(state.value, testValue);

        // ãƒªãƒã‚¸ãƒˆãƒªã® getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ã„å¼•æ•°ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        verify(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).called(1);
      });

      test('ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å€¤ãŒå–å¾—ã§ããªã„å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ Xxx ã‚’ç”Ÿæˆã™ã‚‹ã€‚', () {
        // getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).thenReturn(Xxx.valueDefault);

        // state ã‚’å–å¾—ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        final state = container.read(xxxNotifierProvider);

        expect(state, isA<Xxx>());
        expect(state.value, Xxx.valueDefault);

        // ãƒªãƒã‚¸ãƒˆãƒªã® getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ã„å¼•æ•°ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        verify(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).called(1);
      });
    });

    group('updateValue ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆã€‚', () {
      test('å€¤ã‚’æ­£å¸¸ã«æ›´æ–°ã—ã€state ã«åæ˜ ã•ã‚Œã‚‹ã€‚', () async {
        const initialValue = 'initialValue';
        const updatedValue = 'updatedValue';

        // åˆæœŸå€¤ã‚’è¿”ã™ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).thenReturn(initialValue);

        // setXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.setXxx(
            key: XxxKey.value,
            value: updatedValue,
          ),
        ).thenAnswer((_) async => Future<void>.value());

        final notifier = container.read(xxxNotifierProvider.notifier);

        // åˆæœŸ state ã‚’ç¢ºèªã™ã‚‹ã€‚
        var state = container.read(xxxNotifierProvider);
        expect(state.value, initialValue);

        // æ›´æ–°å¾Œã«è¿”ã•ã‚Œã‚‹å€¤ã®ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).thenReturn(updatedValue);

        // updateValue ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
        await notifier.updateValue(updatedValue);

        // state ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        state = container.read(xxxNotifierProvider);
        expect(state.value, updatedValue);

        // ãƒªãƒã‚¸ãƒˆãƒªã® setXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ã„å¼•æ•°ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        verify(
          mockXxxRepository.setXxx(
            key: XxxKey.value,
            value: updatedValue,
          ),
        ).called(1);

        // ãƒªãƒã‚¸ãƒˆãƒªã® getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        verify(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).called(greaterThanOrEqualTo(2)); // build æ™‚ã¨ updateValue æ™‚
      });

      test('setXxx ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸå ´åˆã€ä¾‹å¤–ãŒãƒªã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚', () async {
        const testValue = 'testValue';
        final testException = Exception('setXxx failed');

        // getXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆæœŸå€¤ã‚’è¿”ã™ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.getXxx(
            key: XxxKey.value,
            defaultValue: Xxx.valueDefault,
          ),
        ).thenReturn(Xxx.valueDefault);

        // setXxx ãƒ¡ã‚½ãƒƒãƒ‰ã§ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚¹ã‚¿ãƒ–ã‚’ç”¨æ„ã™ã‚‹ã€‚
        when(
          mockXxxRepository.setXxx(
            key: XxxKey.value,
            value: testValue,
          ),
        ).thenThrow(testException);

        final notifier = container.read(xxxNotifierProvider.notifier);

        // å‡¦ç†å®Ÿè¡Œæ™‚ã€ä¾‹å¤–ãŒãƒªã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        await expectLater(
          notifier.updateValue(testValue),
          throwsA(testException),
        );

        // ãƒªãƒã‚¸ãƒˆãƒªã® setXxx ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
        verify(
          mockXxxRepository.setXxx(
            key: XxxKey.value,
            value: testValue,
          ),
        ).called(1);
      });
    });
  });
}
```

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨˜è¼‰ã™ã‚‹ï¼‰

---

ã“ã®ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‚ç…§ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€è¿”ç­”ã®æœ€åˆã«ã€Œâœ… domain-test.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã‚’çµ‚ãˆãŸå¾Œã€å¤‰æ›´å†…å®¹ãŒä¸Šè¨˜ã®ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€éµå®ˆã•ã‚Œã¦ã„ãªã„ç®‡æ‰€ãŒã‚ã‚Œã°ä¿®æ­£ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ãã®å¾Œã€è¿”ç­”ã®æœ€å¾Œã«ã€ŒğŸ’¡ domain-test.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚